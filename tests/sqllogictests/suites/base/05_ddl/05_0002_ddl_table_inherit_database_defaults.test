# Test table creation inheriting database default connection options

statement ok
DROP DATABASE IF EXISTS test_db_inherit

# First create the required connection
statement ok
CREATE CONNECTION IF NOT EXISTS default_conn STORAGE_TYPE = 'fs'

# Create database with default connection options
statement ok
CREATE DATABASE test_db_inherit OPTIONS (
    DEFAULT_STORAGE_CONNECTION = 'default_conn',
    DEFAULT_STORAGE_PATH = 'fs:///tmp/05_0002/'
)

# Create a table without explicit connection options
# This table should inherit the database defaults
statement ok
CREATE TABLE test_db_inherit.table_with_defaults (
    id INT,
    name VARCHAR(100)
) ENGINE = Fuse

# Verify table metadata inherits the database defaults
query T
SELECT storage_param FROM system.tables WHERE database = 'test_db_inherit' AND name = 'table_with_defaults'
----
fs | root=/tmp/05_0002/

# Alter database defaults and ensure new tables pick up the updated settings
statement ok
ALTER DATABASE test_db_inherit SET OPTIONS (
    DEFAULT_STORAGE_CONNECTION = 'default_conn',
    DEFAULT_STORAGE_PATH = 'fs:///tmp/05_0002_updated/'
)

statement ok
CREATE TABLE test_db_inherit.table_after_alter (
    id INT,
    name VARCHAR(100)
) ENGINE = Fuse

query T
SELECT storage_param FROM system.tables WHERE database = 'test_db_inherit' AND name = 'table_after_alter'
----
fs | root=/tmp/05_0002_updated/

# Create a table with explicit location
# This should override the database defaults
statement ok
DROP CONNECTION IF EXISTS explicit_conn

statement ok
CREATE CONNECTION IF NOT EXISTS explicit_conn STORAGE_TYPE = 'fs'

statement ok
CREATE TABLE test_db_inherit.table_with_explicit (
    id INT,
    name VARCHAR(100)
) ENGINE = Fuse 'fs:///tmp/05_0002_explicit/' CONNECTION = (connection_name = 'explicit_conn')

query T
SELECT storage_param FROM system.tables WHERE database = 'test_db_inherit' AND name = 'table_with_explicit'
----
fs | root=/tmp/05_0002_explicit/

# Cleanup
statement ok
DROP DATABASE test_db_inherit

statement ok
DROP CONNECTION IF EXISTS explicit_conn

statement ok
DROP CONNECTION IF EXISTS default_conn
