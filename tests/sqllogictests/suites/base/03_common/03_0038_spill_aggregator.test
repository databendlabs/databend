skipif mysql
statement ok
set max_threads = 8;

skipif mysql
statement ok
SET force_aggregate_data_spill = 1;

skipif mysql
query T
SELECT COUNT() FROM (SELECT number::string, count() FROM numbers_mt(100000) group by number::string);
----
100000

skipif mysql
query T
SELECT COUNT() FROM (SELECT number::string FROM numbers_mt(100000) group by number::string);
----
100000

statement ok
create or replace table t2  as select number, max(number) from numbers(10000000) group by number order by number desc limit 3

statement ok
drop table t2

statement ok
set group_by_shuffle_mode = 'before_partial';

skipif mysql
query T
SELECT COUNT() FROM (SELECT number::string, count() FROM numbers_mt(100000) group by number::string);
----
100000

statement ok
unset group_by_shuffle_mode;

skipif mysql
statement ok
unset max_threads;

skipif mysql
statement ok
unset force_aggregate_data_spill;
