# Q60
query I
WITH ss AS
  (SELECT i_item_id,
          sum(ss_ext_sales_price) total_sales
   FROM store_sales,
        date_dim,
        customer_address,
        item
   WHERE i_item_id IN
       (SELECT i_item_id
        FROM item
        WHERE i_category ='Music')
     AND ss_item_sk = i_item_sk
     AND ss_sold_date_sk = d_date_sk
     AND d_year = 1998
     AND d_moy = 9
     AND ss_addr_sk = ca_address_sk
     AND ca_gmt_offset = -5
   GROUP BY i_item_id),
     cs AS
  (SELECT i_item_id,
          sum(cs_ext_sales_price) total_sales
   FROM catalog_sales,
        date_dim,
        customer_address,
        item
   WHERE i_item_id IN
       (SELECT i_item_id
        FROM item
        WHERE i_category ='Music')
     AND cs_item_sk = i_item_sk
     AND cs_sold_date_sk = d_date_sk
     AND d_year = 1998
     AND d_moy = 9
     AND cs_bill_addr_sk = ca_address_sk
     AND ca_gmt_offset = -5
   GROUP BY i_item_id),
     ws AS
  (SELECT i_item_id,
          sum(ws_ext_sales_price) total_sales
   FROM web_sales,
        date_dim,
        customer_address,
        item
   WHERE i_item_id IN
       (SELECT i_item_id
        FROM item
        WHERE i_category = 'Music')
     AND ws_item_sk = i_item_sk
     AND ws_sold_date_sk = d_date_sk
     AND d_year = 1998
     AND d_moy = 9
     AND ws_bill_addr_sk = ca_address_sk
     AND ca_gmt_offset = -5
   GROUP BY i_item_id)
SELECT i_item_id,
       sum(total_sales) total_sales
FROM
  (SELECT *
   FROM ss
   UNION ALL SELECT *
   FROM cs
   UNION ALL SELECT *
   FROM ws) tmp1
GROUP BY i_item_id
ORDER BY i_item_id,
         total_sales
LIMIT 100;
----
AAAAAAAAAABBAAAA 8522.56
AAAAAAAAAABEAAAA 489.71
AAAAAAAAAADCAAAA 16561.96
AAAAAAAAAADEAAAA 23410.14
AAAAAAAAAAHAAAAA 12519.79
AAAAAAAAAANDAAAA 10252.93
AAAAAAAAAAOCAAAA 4001.20
AAAAAAAAABBCAAAA 13963.84
AAAAAAAAABCEAAAA 18916.94
AAAAAAAAABDEAAAA 16610.98
AAAAAAAAABFBAAAA 8019.14
AAAAAAAAABFEAAAA 10145.30
AAAAAAAAABHCAAAA 5214.78
AAAAAAAAABIBAAAA 4240.14
AAAAAAAAABICAAAA 888.44
AAAAAAAAABKCAAAA 8305.73
AAAAAAAAABLBAAAA 2517.56
AAAAAAAAABNAAAAA 6078.55
AAAAAAAAACACAAAA 7642.84
AAAAAAAAACBEAAAA 21131.74
AAAAAAAAACCDAAAA 12089.65
AAAAAAAAACDCAAAA 5974.75
AAAAAAAAACLBAAAA 9762.97
AAAAAAAAACNCAAAA 3951.33
AAAAAAAAACODAAAA 6673.40
AAAAAAAAADACAAAA 19527.67
AAAAAAAAADBAAAAA 4768.23
AAAAAAAAADDCAAAA 21109.19
AAAAAAAAADDEAAAA 7564.97
AAAAAAAAADEEAAAA 4416.78
AAAAAAAAADGEAAAA 4433.35
AAAAAAAAADHDAAAA 8002.70
AAAAAAAAADICAAAA 4593.09
AAAAAAAAADLCAAAA 576.61
AAAAAAAAADNDAAAA 13593.34
AAAAAAAAADPCAAAA 8439.64
AAAAAAAAAEBAAAAA 5865.00
AAAAAAAAAEBCAAAA 8367.62
AAAAAAAAAEBDAAAA 8800.90
AAAAAAAAAECCAAAA 4891.73
AAAAAAAAAECEAAAA 15721.20
AAAAAAAAAEFCAAAA 41.20
AAAAAAAAAEGDAAAA 15994.48
AAAAAAAAAEIBAAAA 3164.02
AAAAAAAAAEICAAAA 16169.04
AAAAAAAAAEKCAAAA 24389.81
AAAAAAAAAEPDAAAA 482.82
AAAAAAAAAFBEAAAA 8514.27
AAAAAAAAAFCDAAAA 14184.82
AAAAAAAAAFDCAAAA 313.04
AAAAAAAAAFFAAAAA 5106.42
AAAAAAAAAFHCAAAA 11884.46
AAAAAAAAAFIAAAAA 5371.87
AAAAAAAAAFJCAAAA 12738.86
AAAAAAAAAFMDAAAA 15442.74
AAAAAAAAAFNBAAAA 22734.46
AAAAAAAAAGBBAAAA 2051.68
AAAAAAAAAGCCAAAA 11734.93
AAAAAAAAAGCDAAAA 23610.90
AAAAAAAAAGDCAAAA 3134.31
AAAAAAAAAGDEAAAA 3109.37
AAAAAAAAAGFAAAAA 652.34
AAAAAAAAAGHAAAAA 21828.51
AAAAAAAAAGHDAAAA 6980.18
AAAAAAAAAGJCAAAA 4403.66
AAAAAAAAAGKAAAAA 10489.49
AAAAAAAAAGKDAAAA 6897.44
AAAAAAAAAGNBAAAA 12117.64
AAAAAAAAAGOCAAAA 13963.63
AAAAAAAAAGPCAAAA 2790.06
AAAAAAAAAHCBAAAA 17168.66
AAAAAAAAAHECAAAA 19055.90
AAAAAAAAAHHDAAAA 10324.12
AAAAAAAAAHJDAAAA 1569.78
AAAAAAAAAHMAAAAA 1525.23
AAAAAAAAAHNDAAAA 12795.28
AAAAAAAAAIACAAAA 587.14
AAAAAAAAAIBCAAAA 1525.26
AAAAAAAAAIBEAAAA 2241.02
AAAAAAAAAIDAAAAA 8907.52
AAAAAAAAAIDCAAAA 14471.77
AAAAAAAAAIIAAAAA 5945.51
AAAAAAAAAIIDAAAA 4248.68
AAAAAAAAAIJCAAAA 24982.50
AAAAAAAAAIMAAAAA 13148.46
AAAAAAAAAINBAAAA 9034.06
AAAAAAAAAINCAAAA 2111.80
AAAAAAAAAIODAAAA 19020.28
AAAAAAAAAIPDAAAA 7332.05
AAAAAAAAAJAEAAAA 23718.86
AAAAAAAAAJCCAAAA 25602.64
AAAAAAAAAJJCAAAA 14139.31
AAAAAAAAAJMBAAAA 5540.98
AAAAAAAAAJMCAAAA 11710.72
AAAAAAAAAJNBAAAA 14304.61
AAAAAAAAAJODAAAA 4732.06
AAAAAAAAAKBAAAAA 12743.02
AAAAAAAAAKDAAAAA 3896.31
AAAAAAAAAKDBAAAA 13561.54
AAAAAAAAAKFBAAAA 11456.11


