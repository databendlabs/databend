# Q79
query I
SELECT c_last_name,
       c_first_name,
       SUBSTRING(s_city,1,30),
       ss_ticket_number,
       amt,
       profit
FROM
  (SELECT ss_ticket_number ,
          ss_customer_sk ,
          store.s_city ,
          sum(ss_coupon_amt) amt ,
          sum(ss_net_profit) profit
   FROM store_sales,
        date_dim,
        store,
        household_demographics
   WHERE store_sales.ss_sold_date_sk = date_dim.d_date_sk
     AND store_sales.ss_store_sk = store.s_store_sk
     AND store_sales.ss_hdemo_sk = household_demographics.hd_demo_sk
     AND (household_demographics.hd_dep_count = 6
          OR household_demographics.hd_vehicle_count > 2)
     AND date_dim.d_dow = 1
     AND date_dim.d_year IN (1999,
                             1999+1,
                             1999+2)
     AND store.s_number_employees BETWEEN 200 AND 295
   GROUP BY ss_ticket_number,
            ss_customer_sk,
            ss_addr_sk,
            store.s_city) ms,
     customer
WHERE ss_customer_sk = c_customer_sk
ORDER BY c_last_name  NULLS FIRST,
         c_first_name  NULLS FIRST,
         SUBSTRING(s_city,1,30)  NULLS FIRST,
         profit NULLS FIRST,
         ss_ticket_number
LIMIT 100;
----
NULL NULL Fairview 213610 3161.48 -15790.23
NULL NULL Fairview 167006 82.87 -14576.82
NULL NULL Fairview 191089 6766.29 -13263.36
NULL NULL Fairview 158139 4396.37 -13020.45
NULL NULL Fairview 7153 219.72 -11749.39
NULL NULL Fairview 125748 6517.12 -11035.56
NULL NULL Fairview 30114 1531.51 -10152.50
NULL NULL Fairview 66717 2535.13 -9902.89
NULL NULL Fairview 66813 272.03 -8104.71
NULL NULL Fairview 129036 600.01 -6430.56
NULL NULL Fairview 146799 1068.86 -6405.03
NULL NULL Fairview 228288 2615.94 -5642.11
NULL NULL Fairview 34621 704.60 -5586.87
NULL NULL Fairview 142379 0.00 -4215.78
NULL NULL Fairview 198542 1133.62 -3800.52
NULL NULL Fairview 163421 1374.10 -3196.51
NULL NULL Fairview 230904 0.00 -1123.68
NULL NULL Fairview 30114 0.00 2558.68
NULL NULL Midway 7696 0.00 NULL
NULL NULL Midway 16363 0.00 NULL
NULL NULL Midway 154925 NULL NULL
NULL NULL Midway 117187 742.86 -23401.99
NULL NULL Midway 56882 1160.00 -23023.64
NULL NULL Midway 123717 564.68 -20689.34
NULL NULL Midway 97953 1698.24 -19708.36
NULL NULL Midway 218338 3475.13 -18444.19
NULL NULL Midway 147740 500.31 -17925.19
NULL NULL Midway 27979 331.84 -17632.32
NULL NULL Midway 188806 32.83 -17621.14
NULL NULL Midway 13073 3994.35 -16930.15
NULL NULL Midway 157905 677.65 -16379.19
NULL NULL Midway 22375 6085.26 -16242.46
NULL NULL Midway 115373 419.52 -15655.52
NULL NULL Midway 109831 4260.99 -15635.94
NULL NULL Midway 118548 2366.60 -15070.44
NULL NULL Midway 153601 317.11 -14878.56
NULL NULL Midway 13424 2738.80 -14444.89
NULL NULL Midway 59324 274.29 -14226.91
NULL NULL Midway 2597 8245.52 -14042.53
NULL NULL Midway 81127 1664.02 -13988.83
NULL NULL Midway 102114 617.65 -13888.54
NULL NULL Midway 152807 5397.19 -13857.50
NULL NULL Midway 44330 920.61 -13781.51
NULL NULL Midway 22249 6322.60 -13598.81
NULL NULL Midway 216619 13337.96 -13290.50
NULL NULL Midway 2018 1840.49 -13243.30
NULL NULL Midway 217339 0.00 -13182.41
NULL NULL Midway 177932 443.33 -12481.29
NULL NULL Midway 72972 1672.32 -12477.23
NULL NULL Midway 32870 6051.93 -12466.81
NULL NULL Midway 88663 5035.89 -11521.85
NULL NULL Midway 145180 5228.92 -11472.84
NULL NULL Midway 144321 825.38 -10916.07
NULL NULL Midway 178696 1001.50 -10780.50
NULL NULL Midway 109728 8846.83 -10736.19
NULL NULL Midway 24453 1620.40 -10488.94
NULL NULL Midway 69241 609.04 -9830.98
NULL NULL Midway 228411 165.94 -9617.15
NULL NULL Midway 88444 5511.84 -9553.76
NULL NULL Midway 31893 1350.64 -9525.79
NULL NULL Midway 84155 1956.89 -9444.35
NULL NULL Midway 229149 1165.26 -9288.28
NULL NULL Midway 7696 2093.28 -9202.28
NULL NULL Midway 103268 0.00 -9160.35
NULL NULL Midway 153218 2845.69 -9144.62
NULL NULL Midway 210261 5042.14 -9085.67
NULL NULL Midway 77368 2359.76 -9059.58
NULL NULL Midway 22110 904.17 -8859.11
NULL NULL Midway 164719 83.40 -8350.70
NULL NULL Midway 16363 3715.96 -8302.37
NULL NULL Midway 113867 229.03 -8203.35
NULL NULL Midway 8272 209.89 -8089.08
NULL NULL Midway 83601 3905.96 -8018.59
NULL NULL Midway 111877 70.72 -8012.10
NULL NULL Midway 63058 3059.47 -7905.21
NULL NULL Midway 195477 5203.55 -7844.40
NULL NULL Midway 51929 2270.70 -7799.68
NULL NULL Midway 180616 1048.13 -7581.10
NULL NULL Midway 23868 997.38 -7242.21
NULL NULL Midway 97140 104.40 -7167.50
NULL NULL Midway 76802 4425.76 -7127.41
NULL NULL Midway 25768 963.54 -7000.64
NULL NULL Midway 214448 975.84 -6801.30
NULL NULL Midway 207733 1761.03 -6730.55
NULL NULL Midway 70150 0.00 -6607.73
NULL NULL Midway 152765 648.30 -6530.17
NULL NULL Midway 10660 1632.34 -6465.33
NULL NULL Midway 230663 3214.41 -6281.51
NULL NULL Midway 6159 270.59 -6210.92
NULL NULL Midway 37443 3150.79 -5895.36
NULL NULL Midway 185866 2335.79 -5883.82
NULL NULL Midway 215748 100.48 -5844.14
NULL NULL Midway 159742 39.59 -5732.03
NULL NULL Midway 95467 239.13 -5592.89
NULL NULL Midway 10538 2257.78 -5460.12
NULL NULL Midway 73742 9840.53 -5458.61
NULL NULL Midway 362 9.01 -5118.42
NULL NULL Midway 230745 170.50 -5114.91
NULL NULL Midway 64117 761.54 -5061.23
NULL NULL Midway 229921 2708.42 -4992.39


