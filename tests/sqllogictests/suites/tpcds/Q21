# Q21
query I
SELECT *
FROM
  (SELECT w_warehouse_name,
          i_item_id,
          sum(CASE
                  WHEN (cast(d_date AS date) < CAST ('2000-03-11' AS date)) THEN inv_quantity_on_hand
                  ELSE 0
              END) AS inv_before,
          sum(CASE
                  WHEN (cast(d_date AS date) >= CAST ('2000-03-11' AS date)) THEN inv_quantity_on_hand
                  ELSE 0
              END) AS inv_after
   FROM inventory,
        warehouse,
        item,
        date_dim
   WHERE i_current_price BETWEEN 0.99 AND 1.49
     AND i_item_sk = inv_item_sk
     AND inv_warehouse_sk = w_warehouse_sk
     AND inv_date_sk = d_date_sk
     AND d_date BETWEEN CAST ('2000-02-10' AS date) AND CAST ('2000-04-10' AS date)
   GROUP BY w_warehouse_name,
            i_item_id) x
WHERE (CASE
           WHEN inv_before > 0 THEN (inv_after*1.000) / inv_before
           ELSE NULL
       END) BETWEEN 2.000/3.000 AND 3.000/2.000
ORDER BY w_warehouse_name NULLS FIRST,
         i_item_id NULLS FIRST
LIMIT 100;
----
NULL AAAAAAAAAABDAAAA 2565 1922
NULL AAAAAAAAAAHDAAAA 2956 2052
NULL AAAAAAAAAALAAAAA 2042 1793
NULL AAAAAAAAABDAAAAA 3340 2626
NULL AAAAAAAAACGCAAAA 2373 1771
NULL AAAAAAAAACKCAAAA 2321 1856
NULL AAAAAAAAACOBAAAA 1504 1397
NULL AAAAAAAAADKBAAAA 1820 2163
NULL AAAAAAAAAEADAAAA 2631 1965
NULL AAAAAAAAAEOCAAAA 1659 1798
NULL AAAAAAAAAFACAAAA 1965 1705
NULL AAAAAAAAAFADAAAA 1769 1313
NULL AAAAAAAAAHDEAAAA 2700 1985
NULL AAAAAAAAAHHAAAAA 1578 1082
NULL AAAAAAAAAIECAAAA 1756 1804
NULL AAAAAAAAAIMCAAAA 3603 2951
NULL AAAAAAAAAJACAAAA 2109 1989
NULL AAAAAAAAAJKBAAAA 2573 3540
NULL AAAAAAAAALBEAAAA 3458 2992
NULL AAAAAAAAALCEAAAA 1720 1810
NULL AAAAAAAAALECAAAA 2569 1946
NULL AAAAAAAAALNBAAAA 2552 1750
NULL AAAAAAAAANFEAAAA 2022 2269
NULL AAAAAAAAAOBBAAAA 1603 1592
NULL AAAAAAAAAOIBAAAA 2982 2540
NULL AAAAAAAAAPJBAAAA 2344 2593
NULL AAAAAAAABAPDAAAA 2182 2787
NULL AAAAAAAABDCEAAAA 2844 2069
NULL AAAAAAAABDDDAAAA 2417 2537
NULL AAAAAAAABDJAAAAA 1584 1666
NULL AAAAAAAABEODAAAA 2141 2649
NULL AAAAAAAABFCCAAAA 2745 2020
NULL AAAAAAAABFMBAAAA 1642 1364
NULL AAAAAAAABHPCAAAA 1923 1780
NULL AAAAAAAABIDBAAAA 1956 2836
NULL AAAAAAAABIGBAAAA 2023 2344
NULL AAAAAAAABIJBAAAA 1977 2728
NULL AAAAAAAABJFEAAAA 1891 2390
NULL AAAAAAAABLDEAAAA 1983 1797
NULL AAAAAAAABNIDAAAA 2485 2324
NULL AAAAAAAABNLDAAAA 2385 2786
NULL AAAAAAAABOMBAAAA 2291 2092
NULL AAAAAAAACAAAAAAA 2233 2560
NULL AAAAAAAACBCDAAAA 1540 2012
NULL AAAAAAAACBIAAAAA 2394 2122
NULL AAAAAAAACBPBAAAA 1790 1661
NULL AAAAAAAACCMDAAAA 2654 2691
NULL AAAAAAAACDBCAAAA 1804 2072
NULL AAAAAAAACFEAAAAA 1941 1567
NULL AAAAAAAACFHDAAAA 1696 1147
NULL AAAAAAAACGFDAAAA 2123 2265
NULL AAAAAAAACHPCAAAA 2933 2174
NULL AAAAAAAACIGDAAAA 2618 2399
NULL AAAAAAAACJCBAAAA 2728 2367
NULL AAAAAAAACJLAAAAA 1350 1732
NULL AAAAAAAACLAEAAAA 2578 2329
NULL AAAAAAAACLGAAAAA 1842 1588
NULL AAAAAAAACLLBAAAA 3418 2657
NULL AAAAAAAACLOBAAAA 3115 2560
NULL AAAAAAAACMADAAAA 1991 2243
NULL AAAAAAAACMJAAAAA 1261 1855
NULL AAAAAAAACMLAAAAA 3288 2753
NULL AAAAAAAACMPDAAAA 1320 1676
NULL AAAAAAAACNGBAAAA 2340 2118
NULL AAAAAAAACNHDAAAA 3519 3348
NULL AAAAAAAACNPCAAAA 2561 1948
NULL AAAAAAAADCPCAAAA 2664 2627
NULL AAAAAAAADDHAAAAA 1313 1926
NULL AAAAAAAADDNDAAAA 1109 835
NULL AAAAAAAADEAAAAAA 2141 1847
NULL AAAAAAAADEJAAAAA 3142 2723
NULL AAAAAAAADFKBAAAA 1470 1650
NULL AAAAAAAADGCCAAAA 2113 2331
NULL AAAAAAAADGFCAAAA 2201 2928
NULL AAAAAAAADHPAAAAA 2467 2133
NULL AAAAAAAADMBAAAAA 3085 2087
NULL AAAAAAAADPABAAAA 3494 3081
NULL AAAAAAAAEAECAAAA 2133 2148
NULL AAAAAAAAEAPAAAAA 1560 1275
NULL AAAAAAAAECGCAAAA 2815 3307
NULL AAAAAAAAEDPDAAAA 2731 1883
NULL AAAAAAAAEEECAAAA 2024 1902
NULL AAAAAAAAEEMCAAAA 2624 2387
NULL AAAAAAAAEFFAAAAA 2047 1878
NULL AAAAAAAAEGJAAAAA 2403 2633
NULL AAAAAAAAEGMAAAAA 2784 2772
NULL AAAAAAAAEGOCAAAA 2389 1753
NULL AAAAAAAAEHFDAAAA 1940 1420
NULL AAAAAAAAEHLBAAAA 2320 2057
NULL AAAAAAAAEHPAAAAA 1898 1853
NULL AAAAAAAAEIPBAAAA 2930 2326
NULL AAAAAAAAEJAEAAAA 2582 1836
NULL AAAAAAAAEJIBAAAA 2257 1681
NULL AAAAAAAAEJJAAAAA 2791 1941
NULL AAAAAAAAEJJDAAAA 3410 2405
NULL AAAAAAAAEJNCAAAA 2472 2067
NULL AAAAAAAAEJPDAAAA 1219 1229
NULL AAAAAAAAEKEBAAAA 2047 1713
NULL AAAAAAAAEMEAAAAA 2502 1897
NULL AAAAAAAAEMKCAAAA 2362 2042


