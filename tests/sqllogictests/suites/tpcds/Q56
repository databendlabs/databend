# Q56
query I
WITH ss AS
  (SELECT i_item_id,
          sum(ss_ext_sales_price) total_sales
   FROM store_sales,
        date_dim,
        customer_address,
        item
   WHERE i_item_id IN
       (SELECT i_item_id
        FROM item
        WHERE i_color IN ('slate',
                          'blanched',
                          'burnished'))
     AND ss_item_sk = i_item_sk
     AND ss_sold_date_sk = d_date_sk
     AND d_year = 2001
     AND d_moy = 2
     AND ss_addr_sk = ca_address_sk
     AND ca_gmt_offset = -5
   GROUP BY i_item_id),
     cs AS
  (SELECT i_item_id,
          sum(cs_ext_sales_price) total_sales
   FROM catalog_sales,
        date_dim,
        customer_address,
        item
   WHERE i_item_id IN
       (SELECT i_item_id
        FROM item
        WHERE i_color IN ('slate',
                          'blanched',
                          'burnished'))
     AND cs_item_sk = i_item_sk
     AND cs_sold_date_sk = d_date_sk
     AND d_year = 2001
     AND d_moy = 2
     AND cs_bill_addr_sk = ca_address_sk
     AND ca_gmt_offset = -5
   GROUP BY i_item_id),
     ws AS
  (SELECT i_item_id,
          sum(ws_ext_sales_price) total_sales
   FROM web_sales,
        date_dim,
        customer_address,
        item
   WHERE i_item_id IN
       (SELECT i_item_id
        FROM item
        WHERE i_color IN ('slate',
                          'blanched',
                          'burnished'))
     AND ws_item_sk = i_item_sk
     AND ws_sold_date_sk = d_date_sk
     AND d_year = 2001
     AND d_moy = 2
     AND ws_bill_addr_sk = ca_address_sk
     AND ca_gmt_offset = -5
   GROUP BY i_item_id)
SELECT i_item_id,
       sum(total_sales) total_sales
FROM
  (SELECT *
   FROM ss
   UNION ALL SELECT *
   FROM cs
   UNION ALL SELECT *
   FROM ws) tmp1
GROUP BY i_item_id
ORDER BY total_sales  NULLS FIRST,
         i_item_id NULLS FIRST
LIMIT 100;
----
AAAAAAAAMBNDAAAA NULL
AAAAAAAAMOAAAAAA NULL
AAAAAAAAEMICAAAA 0.00
AAAAAAAAEPDEAAAA 0.00
AAAAAAAAAPABAAAA 5.85
AAAAAAAANEFAAAAA 6.93
AAAAAAAADOIDAAAA 8.36
AAAAAAAAEJLBAAAA 10.28
AAAAAAAAINGBAAAA 13.57
AAAAAAAAGNDDAAAA 17.85
AAAAAAAAKFFCAAAA 21.21
AAAAAAAAOKNBAAAA 29.54
AAAAAAAAMEKAAAAA 29.75
AAAAAAAABIDEAAAA 31.93
AAAAAAAAKMPAAAAA 51.45
AAAAAAAAKEGCAAAA 63.10
AAAAAAAACPIBAAAA 66.25
AAAAAAAAIKFAAAAA 74.63
AAAAAAAAJHNCAAAA 80.08
AAAAAAAAMGCCAAAA 80.32
AAAAAAAANDHCAAAA 84.15
AAAAAAAAKMCCAAAA 84.96
AAAAAAAAIBBAAAAA 91.26
AAAAAAAAOLPAAAAA 95.60
AAAAAAAAAPDBAAAA 99.72
AAAAAAAACIBAAAAA 102.08
AAAAAAAAEOIDAAAA 127.40
AAAAAAAAGHBCAAAA 153.79
AAAAAAAAGJHDAAAA 158.46
AAAAAAAAKFNDAAAA 161.70
AAAAAAAAHHBBAAAA 164.28
AAAAAAAAIOAAAAAA 166.04
AAAAAAAAJGBDAAAA 182.85
AAAAAAAALNHDAAAA 193.80
AAAAAAAAMKAEAAAA 208.50
AAAAAAAAGLIDAAAA 208.62
AAAAAAAAKPKCAAAA 224.98
AAAAAAAAOFDAAAAA 251.22
AAAAAAAAKOPBAAAA 251.25
AAAAAAAANFPBAAAA 285.84
AAAAAAAAONBAAAAA 290.40
AAAAAAAAEGPAAAAA 292.22
AAAAAAAADEJAAAAA 295.24
AAAAAAAAFBGBAAAA 326.16
AAAAAAAAJHGDAAAA 327.31
AAAAAAAAIDECAAAA 332.35
AAAAAAAAELHAAAAA 362.02
AAAAAAAAEKCDAAAA 365.50
AAAAAAAAPLEBAAAA 367.40
AAAAAAAAOFECAAAA 384.26
AAAAAAAAGBPBAAAA 385.65
AAAAAAAAEGDDAAAA 409.04
AAAAAAAAMACAAAAA 427.59
AAAAAAAAEHKBAAAA 432.25
AAAAAAAAINHAAAAA 438.38
AAAAAAAAEPPBAAAA 444.88
AAAAAAAAOICEAAAA 473.24
AAAAAAAAEMHCAAAA 484.38
AAAAAAAADGDEAAAA 502.18
AAAAAAAAANCBAAAA 529.56
AAAAAAAAAFNBAAAA 529.83
AAAAAAAAHOBDAAAA 538.18
AAAAAAAAHAFEAAAA 544.50
AAAAAAAACNACAAAA 548.34
AAAAAAAAOCEAAAAA 588.39
AAAAAAAAEMDBAAAA 592.32
AAAAAAAAGANAAAAA 603.09
AAAAAAAACCOBAAAA 604.80
AAAAAAAAMBNAAAAA 619.18
AAAAAAAAKNCEAAAA 621.26
AAAAAAAAKDGDAAAA 633.24
AAAAAAAAABLBAAAA 636.50
AAAAAAAAKIEEAAAA 638.91
AAAAAAAAGMGBAAAA 641.58
AAAAAAAAENCBAAAA 643.55
AAAAAAAAIGBEAAAA 663.52
AAAAAAAAGBEAAAAA 694.20
AAAAAAAAHIOCAAAA 694.88
AAAAAAAAAELCAAAA 707.52
AAAAAAAACENDAAAA 744.50
AAAAAAAAIOCEAAAA 755.65
AAAAAAAAKGFBAAAA 780.07
AAAAAAAADIBBAAAA 795.40
AAAAAAAAGIOBAAAA 796.95
AAAAAAAAJBCEAAAA 821.26
AAAAAAAAKFKBAAAA 832.56
AAAAAAAANNEBAAAA 835.12
AAAAAAAALOCEAAAA 885.78
AAAAAAAAKPFEAAAA 898.56
AAAAAAAAAEGAAAAA 901.81
AAAAAAAACAPCAAAA 909.96
AAAAAAAAIKCAAAAA 919.81
AAAAAAAALFADAAAA 930.80
AAAAAAAAMMCAAAAA 933.98
AAAAAAAACCPAAAAA 936.08
AAAAAAAAKCABAAAA 944.85
AAAAAAAAALIBAAAA 962.70
AAAAAAAAKMBCAAAA 977.68
AAAAAAAAAPNBAAAA 985.01
AAAAAAAAIKNBAAAA 1005.17


