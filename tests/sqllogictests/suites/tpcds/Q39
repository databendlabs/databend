# Q39
query I

WITH inv AS
  (SELECT w_warehouse_name,
          w_warehouse_sk,
          i_item_sk,
          d_moy,
          stdev,
          mean,
          CASE mean
              WHEN 0 THEN NULL
              ELSE stdev/mean
          END cov
   FROM
     (SELECT w_warehouse_name,
             w_warehouse_sk,
             i_item_sk,
             d_moy,
             stddev_samp(inv_quantity_on_hand)*1.000 stdev,
             avg(inv_quantity_on_hand) mean
      FROM inventory,
           item,
           warehouse,
           date_dim
      WHERE inv_item_sk = i_item_sk
        AND inv_warehouse_sk = w_warehouse_sk
        AND inv_date_sk = d_date_sk
        AND d_year =2001
      GROUP BY w_warehouse_name,
               w_warehouse_sk,
               i_item_sk,
               d_moy) foo
   WHERE CASE mean
             WHEN 0 THEN 0
             ELSE stdev/mean
         END > 1)
SELECT inv1.w_warehouse_sk wsk1,
       inv1.i_item_sk isk1,
       inv1.d_moy dmoy1,
       inv1.mean mean1,
       round(inv1.cov, 3) cov1,
       inv2.w_warehouse_sk,
       inv2.i_item_sk,
       inv2.d_moy,
       inv2.mean,
       round(inv2.cov, 3)
FROM inv inv1,
     inv inv2
WHERE inv1.i_item_sk = inv2.i_item_sk
  AND inv1.w_warehouse_sk = inv2.w_warehouse_sk
  AND inv1.d_moy=1
  AND inv2.d_moy=1+1
ORDER BY inv1.w_warehouse_sk NULLS FIRST,
         inv1.i_item_sk NULLS FIRST,
         inv1.d_moy NULLS FIRST,
         inv1.mean NULLS FIRST,
         inv1.cov NULLS FIRST,
         inv2.d_moy NULLS FIRST,
         inv2.mean NULLS FIRST,
         inv2.cov NULLS FIRST;
----
1 265 1 324.75 1.244 1 265 2 329.0 1.015
1 363 1 499.5 1.032 1 363 2 321.0 1.141
1 679 1 373.75 1.096 1 679 2 417.5 1.043
1 695 1 450.75 1.084 1 695 2 368.75 1.136
1 789 1 357.25 1.035 1 789 2 410.0 1.028
1 815 1 216.5 1.17 1 815 2 150.5 1.306
1 827 1 271.75 1.105 1 827 2 424.75 1.165
1 1041 1 382.5 1.285 1 1041 2 424.75 1.001
1 1569 1 212.0 1.63 1 1569 2 239.25 1.264
1 1623 1 338.25 1.129 1 1623 2 261.3333333333333 1.272
1 2581 1 448.5 1.06 1 2581 2 476.25 1.036
1 2705 1 246.25 1.012 1 2705 2 294.6666666666667 1.074
1 3131 1 393.75 1.004 1 3131 2 480.5 1.067
1 3291 1 374.5 1.195 1 3291 2 265.25 1.573
1 3687 1 279.75 1.426 1 3687 2 157.25 1.453
1 4955 1 495.25 1.032 1 4955 2 322.5 1.169
1 5627 1 282.75 1.566 1 5627 2 297.5 1.208
1 7017 1 175.5 1.043 1 7017 2 321.3333333333333 1.018
1 7317 1 366.3333333333333 1.025 1 7317 2 378.0 1.217
1 7569 1 430.5 1.087 1 7569 2 360.25 1.047
1 7999 1 166.25 1.792 1 7999 2 375.3333333333333 1.008
1 8319 1 306.75 1.162 1 8319 2 276.0 1.142
1 8443 1 327.75 1.257 1 8443 2 332.5 1.004
1 8583 1 319.5 1.024 1 8583 2 310.25 1.236
1 8591 1 398.0 1.148 1 8591 2 355.75 1.002
1 8611 1 300.5 1.519 1 8611 2 243.75 1.234
1 9081 1 367.0 1.088 1 9081 2 435.0 1.033
1 9357 1 351.6666666666667 1.19 1 9357 2 427.0 1.044
1 9449 1 406.25 1.018 1 9449 2 175.0 1.054
1 9713 1 242.5 1.104 1 9713 2 393.0 1.208
1 9809 1 479.0 1.019 1 9809 2 317.5 1.061
1 9993 1 417.75 1.01 1 9993 2 204.5 1.553
1 10127 1 239.75 1.056 1 10127 2 359.25 1.186
1 11159 1 407.25 1.079 1 11159 2 250.0 1.335
1 11277 1 211.25 1.262 1 11277 2 330.75 1.081
1 11937 1 344.5 1.086 1 11937 2 200.33333333333334 1.064
1 12373 1 387.75 1.101 1 12373 2 306.0 1.076
1 12471 1 365.25 1.061 1 12471 2 327.25 1.055
1 12625 1 279.0 1.302 1 12625 2 443.25 1.06
1 12751 1 280.75 1.108 1 12751 2 369.3333333333333 1.342
1 12779 1 331.0 1.042 1 12779 2 359.0 1.029
1 13077 1 367.6666666666667 1.346 1 13077 2 358.6666666666667 1.513
1 13191 1 260.25 1.064 1 13191 2 405.0 1.02
1 13561 1 335.25 1.261 1 13561 2 240.0 1.051
1 13935 1 311.75 1.04 1 13935 2 275.0 1.037
1 14687 1 358.0 1.437 1 14687 2 187.0 1.549
1 14719 1 209.0 1.041 1 14719 2 489.0 1.377
1 15345 1 148.5 1.53 1 15345 2 246.5 1.509
1 15427 1 482.75 1.012 1 15427 2 333.25 1.272
1 15647 1 201.66666666666666 1.286 1 15647 2 249.25 1.365
1 16079 1 280.5 1.244 1 16079 2 361.25 1.074
1 16223 1 245.66666666666666 1.06 1 16223 2 412.6666666666667 1.067
1 16289 1 171.0 1.087 1 16289 2 316.5 1.37
1 16451 1 300.0 1.252 1 16451 2 467.5 1.296
1 17051 1 349.75 1.135 1 17051 2 319.75 1.038
2 71 1 221.5 1.564 2 71 2 309.0 1.492
2 833 1 363.3333333333333 1.042 2 833 2 158.75 1.213
2 969 1 282.0 1.137 2 969 2 386.0 1.137
2 1401 1 249.0 1.321 2 1401 2 296.6666666666667 1.287
2 1681 1 337.75 1.052 2 1681 2 252.75 1.032
2 1991 1 356.0 1.134 2 1991 2 273.25 1.332
2 2031 1 407.5 1.021 2 2031 2 418.75 1.005
2 2481 1 319.75 1.116 2 2481 2 378.3333333333333 1.06
2 2725 1 349.75 1.115 2 2725 2 265.6666666666667 1.546
2 3073 1 385.0 1.102 2 3073 2 231.75 1.088
2 3769 1 334.0 1.195 2 3769 2 335.0 1.049
2 4085 1 327.75 1.101 2 4085 2 281.75 1.019
2 4995 1 282.25 1.26 2 4995 2 248.0 1.255
2 5099 1 418.6666666666667 1.068 2 5099 2 428.6666666666667 1.035
2 5211 1 157.0 1.07 2 5211 2 270.25 1.194
2 5769 1 341.25 1.272 2 5769 2 267.0 1.182
2 6103 1 194.33333333333334 1.516 2 6103 2 158.5 1.274
2 6243 1 168.5 1.073 2 6243 2 386.75 1.083
2 6489 1 268.0 1.696 2 6489 2 389.0 1.411
2 6585 1 183.75 1.115 2 6585 2 353.75 1.094
2 6767 1 341.0 1.093 2 6767 2 235.0 1.14
2 7411 1 460.0 1.063 2 7411 2 297.5 1.001
2 8489 1 126.75 1.342 2 8489 2 398.25 1.004
2 8633 1 218.5 1.465 2 8633 2 230.25 1.312
2 8807 1 417.25 1.026 2 8807 2 356.25 1.108
2 8883 1 249.25 1.111 2 8883 2 189.25 1.01
2 9253 1 413.3333333333333 1.161 2 9253 2 465.0 1.024
2 9467 1 108.25 1.091 2 9467 2 107.0 1.031
2 9561 1 190.5 1.03 2 9561 2 271.0 1.206
2 9575 1 452.5 1.049 2 9575 2 155.75 1.153
2 9903 1 322.75 1.076 2 9903 2 387.3333333333333 1.261
2 10535 1 324.3333333333333 1.057 2 10535 2 310.25 1.004
2 10955 1 356.0 1.158 2 10955 2 339.0 1.07
2 12089 1 212.0 1.083 2 12089 2 173.33333333333334 1.074
2 12633 1 402.75 1.007 2 12633 2 367.0 1.127
2 12765 1 308.0 1.119 2 12765 2 347.0 1.157
2 13077 1 277.0 1.232 2 13077 2 223.5 1.139
2 13687 1 361.25 1.011 2 13687 2 468.25 1.01
2 14025 1 371.75 1.015 2 14025 2 141.0 1.254
2 14117 1 298.5 1.025 2 14117 2 220.25 1.415
2 14347 1 366.0 1.033 2 14347 2 369.75 1.019
2 14697 1 397.75 1.008 2 14697 2 328.75 1.161
2 14987 1 146.75 1.029 2 14987 2 436.5 1.045
2 15321 1 527.0 1.21 2 15321 2 298.75 1.131
2 15347 1 243.0 1.223 2 15347 2 310.75 1.204
2 15533 1 223.0 1.097 2 15533 2 330.0 1.497
2 15839 1 353.0 1.506 2 15839 2 255.5 1.236
2 16107 1 376.0 1.013 2 16107 2 364.75 1.069
2 16749 1 200.0 1.094 2 16749 2 438.25 1.036
2 17329 1 321.3333333333333 1.309 2 17329 2 490.25 1.076
2 17417 1 321.75 1.131 2 17417 2 534.0 1.001
3 1049 1 252.5 1.109 3 1049 2 457.25 1.024
3 1415 1 247.5 1.132 3 1415 2 369.75 1.095
3 2199 1 185.75 1.203 3 2199 2 300.75 1.077
3 2403 1 270.75 1.326 3 2403 2 384.0 1.09
3 2541 1 364.75 1.079 3 2541 2 550.5 1.055
3 2727 1 303.75 1.03 3 2727 2 219.25 1.382
3 3207 1 383.75 1.085 3 3207 2 258.25 1.211
3 3373 1 404.5 1.014 3 3373 2 171.25 1.286
3 3969 1 234.25 1.042 3 3969 2 217.25 1.422
3 4407 1 438.5 1.066 3 4407 2 330.75 1.024
3 6051 1 289.75 1.264 3 6051 2 439.0 1.105
3 6521 1 381.0 1.002 3 6521 2 437.75 1.037
3 6691 1 377.0 1.109 3 6691 2 380.5 1.058
3 6757 1 282.5 1.09 3 6757 2 345.25 1.226
3 6915 1 420.6666666666667 1.047 3 6915 2 292.5 1.251
3 7207 1 329.6666666666667 1.595 3 7207 2 414.5 1.018
3 7889 1 318.5 1.288 3 7889 2 291.3333333333333 1.004
3 8559 1 356.25 1.007 3 8559 2 393.5 1.013
3 8829 1 364.25 1.079 3 8829 2 350.25 1.113
3 9555 1 377.0 1.131 3 9555 2 444.75 1.017
3 9623 1 331.3333333333333 1.155 3 9623 2 284.6666666666667 1.03
3 9813 1 343.75 1.052 3 9813 2 384.6666666666667 1.082
3 9881 1 351.5 1.179 3 9881 2 287.75 1.091
3 10035 1 378.25 1.022 3 10035 2 364.25 1.157
3 10509 1 420.25 1.055 3 10509 2 368.25 1.182
3 10547 1 182.33333333333334 1.533 3 10547 2 320.25 1.302
3 10743 1 233.25 1.279 3 10743 2 110.25 1.107
3 11477 1 264.25 1.095 3 11477 2 278.5 1.033
3 11959 1 358.0 1.068 3 11959 2 268.5 1.009
3 12043 1 169.25 1.033 3 12043 2 377.25 1.016
3 12157 1 326.3333333333333 1.002 3 12157 2 396.3333333333333 1.029
3 12433 1 199.75 1.307 3 12433 2 478.5 1.016
3 12867 1 278.25 1.64 3 12867 2 350.75 1.201
3 13499 1 281.0 1.143 3 13499 2 446.75 1.033
3 14589 1 266.5 1.114 3 14589 2 334.3333333333333 1.145
3 15207 1 300.25 1.484 3 15207 2 564.0 1.0
3 15395 1 258.25 1.051 3 15395 2 307.5 1.138
3 15973 1 477.5 1.204 3 15973 2 286.0 1.287
3 16233 1 260.6666666666667 1.12 3 16233 2 210.5 1.179
3 16267 1 456.0 1.004 3 16267 2 364.3333333333333 1.482
3 16605 1 394.25 1.114 3 16605 2 296.25 1.289
3 16949 1 155.75 1.119 3 16949 2 229.5 1.029
3 17319 1 364.75 1.271 3 17319 2 359.25 1.158
4 947 1 247.5 1.693 4 947 2 203.33333333333334 1.205
4 1895 1 354.75 1.24 4 1895 2 383.75 1.089
4 3429 1 358.5 1.067 4 3429 2 346.0 1.252
4 4559 1 215.0 1.243 4 4559 2 360.75 1.033
4 4773 1 328.25 1.051 4 4773 2 330.5 1.006
4 4885 1 151.0 1.321 4 4885 2 377.25 1.049
4 4915 1 289.25 1.086 4 4915 2 368.0 1.07
4 5043 1 476.0 1.016 4 5043 2 244.25 1.356
4 5095 1 334.0 1.226 4 5095 2 390.25 1.062
4 5193 1 263.3333333333333 1.25 4 5193 2 323.0 1.098
4 5975 1 434.0 1.023 4 5975 2 359.75 1.198
4 6251 1 285.0 1.122 4 6251 2 335.5 1.16
4 6389 1 280.75 1.205 4 6389 2 259.3333333333333 1.482
4 6487 1 452.75 1.071 4 6487 2 350.5 1.172
4 6619 1 430.0 1.001 4 6619 2 226.25 1.549
4 7191 1 260.75 1.001 4 7191 2 195.25 1.537
4 7427 1 239.5 1.418 4 7427 2 373.25 1.043
4 8453 1 314.75 1.026 4 8453 2 376.75 1.01
4 8781 1 518.5 1.101 4 8781 2 521.0 1.124
4 9571 1 314.0 1.217 4 9571 2 309.0 1.089
4 9587 1 248.0 1.498 4 9587 2 248.0 1.006
4 10333 1 321.0 1.149 4 10333 2 317.0 1.047
4 10969 1 186.66666666666666 1.104 4 10969 2 307.0 1.109
4 10993 1 446.0 1.009 4 10993 2 206.66666666666666 1.236
4 11571 1 342.5 1.143 4 11571 2 304.6666666666667 1.032
4 11979 1 225.33333333333334 1.467 4 11979 2 438.25 1.139
4 13409 1 312.3333333333333 1.343 4 13409 2 336.25 1.108
4 13443 1 417.75 1.022 4 13443 2 334.0 1.308
4 13567 1 271.5 1.009 4 13567 2 370.0 1.456
4 13683 1 318.75 1.015 4 13683 2 363.5 1.078
4 14143 1 367.0 1.044 4 14143 2 290.0 1.193
4 14401 1 342.75 1.184 4 14401 2 344.25 1.207
4 14693 1 447.25 1.052 4 14693 2 498.0 1.352
4 14877 1 414.3333333333333 1.171 4 14877 2 282.5 1.583
4 15063 1 378.25 1.113 4 15063 2 444.0 1.063
4 15275 1 335.5 1.154 4 15275 2 292.6666666666667 1.298
4 15509 1 296.3333333333333 1.025 4 15509 2 317.6666666666667 1.447
4 15969 1 423.0 1.047 4 15969 2 342.5 1.251
4 16627 1 485.5 1.015 4 16627 2 161.25 1.353
4 16641 1 521.5 1.105 4 16641 2 221.5 1.031
4 16751 1 549.5 1.082 4 16751 2 223.33333333333334 1.338
5 75 1 333.0 1.266 5 75 2 226.0 1.036
5 125 1 441.6666666666667 1.096 5 125 2 331.5 1.008
5 431 1 159.0 1.106 5 431 2 304.0 1.122
5 671 1 403.3333333333333 1.006 5 671 2 281.3333333333333 1.337
5 745 1 466.75 1.011 5 745 2 351.0 1.115
5 1701 1 374.0 1.086 5 1701 2 385.0 1.331
5 2521 1 360.75 1.099 5 2521 2 265.5 1.172
5 2855 1 406.0 1.404 5 2855 2 183.25 1.066
5 3137 1 271.25 1.575 5 3137 2 380.0 1.083
5 3279 1 299.5 1.054 5 3279 2 276.75 1.446
5 3467 1 294.0 1.148 5 3467 2 349.6666666666667 1.167
5 4463 1 338.0 1.07 5 4463 2 273.5 1.237
5 4719 1 340.5 1.057 5 4719 2 423.6666666666667 1.026
5 4739 1 281.3333333333333 1.024 5 4739 2 383.5 1.033
5 4839 1 310.25 1.036 5 4839 2 232.0 1.295
5 4979 1 359.5 1.105 5 4979 2 323.75 1.17
5 5401 1 219.25 1.277 5 5401 2 203.0 1.092
5 5635 1 370.0 1.023 5 5635 2 351.6666666666667 1.378
5 5797 1 403.0 1.023 5 5797 2 457.5 1.004
5 5901 1 360.25 1.126 5 5901 2 376.0 1.01
5 6129 1 419.25 1.017 5 6129 2 359.5 1.048
5 6213 1 351.6666666666667 1.206 5 6213 2 361.5 1.117
5 6479 1 301.3333333333333 1.278 5 6479 2 395.75 1.178
5 7333 1 227.0 1.461 5 7333 2 243.75 1.179
5 7923 1 358.0 1.105 5 7923 2 342.3333333333333 1.161
5 8737 1 217.25 1.074 5 8737 2 403.5 1.044
5 8945 1 344.25 1.141 5 8945 2 298.0 1.001
5 8993 1 399.0 1.187 5 8993 2 371.75 1.132
5 10667 1 288.0 1.345 5 10667 2 289.5 1.095
5 10771 1 394.75 1.048 5 10771 2 323.25 1.238
5 10949 1 383.0 1.113 5 10949 2 378.25 1.126
5 11107 1 446.5 1.265 5 11107 2 258.5 1.554
5 11795 1 395.5 1.01 5 11795 2 430.75 1.131
5 12017 1 347.75 1.168 5 12017 2 308.0 1.159
5 12027 1 456.25 1.026 5 12027 2 390.3333333333333 1.114
5 13583 1 430.3333333333333 1.042 5 13583 2 256.25 1.541
5 13651 1 272.3333333333333 1.17 5 13651 2 330.5 1.19
5 13783 1 419.5 1.058 5 13783 2 339.5 1.068
5 13859 1 318.0 1.142 5 13859 2 380.25 1.056
5 14537 1 206.0 1.228 5 14537 2 357.75 1.039
5 15309 1 276.3333333333333 1.299 5 15309 2 409.0 1.01
5 15883 1 385.3333333333333 1.012 5 15883 2 173.25 1.356
5 15935 1 293.5 1.019 5 15935 2 271.25 1.4
5 15949 1 241.5 1.149 5 15949 2 235.0 1.407
5 16037 1 327.25 1.131 5 16037 2 412.6666666666667 1.183
5 16291 1 380.5 1.055 5 16291 2 411.6666666666667 1.035
5 16459 1 370.0 1.276 5 16459 2 265.75 1.299
5 16901 1 305.25 1.104 5 16901 2 186.5 1.023
5 17199 1 376.5 1.104 5 17199 2 374.0 1.087
5 17387 1 298.3333333333333 1.385 5 17387 2 327.6666666666667 1.367
5 17717 1 283.75 1.156 5 17717 2 235.25 1.142
5 17927 1 217.5 1.355 5 17927 2 250.75 1.071
5 17943 1 209.75 1.372 5 17943 2 428.0 1.109



