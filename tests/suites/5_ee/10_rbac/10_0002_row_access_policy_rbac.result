#### prepare row access policy rbac environment
>>>> SET GLOBAL enable_experimental_row_access_policy = 1
>>>> DROP TABLE IF EXISTS rap_rbac
>>>> DROP ROW ACCESS POLICY IF EXISTS rap_region
>>>> DROP ROW ACCESS POLICY IF EXISTS rap_dept
>>>> DROP USER IF EXISTS rap_create
>>>> DROP USER IF EXISTS rap_apply
>>>> DROP ROLE IF EXISTS role_rap_apply
>>>> DROP ROLE IF EXISTS role_rap_create
>>>> CREATE TABLE rap_rbac(id INT, region STRING, dept STRING)
>>>> CREATE USER rap_create IDENTIFIED BY '123' with default_role='role_rap_create'
>>>> CREATE USER rap_apply IDENTIFIED BY '123' with default_role='role_rap_apply'
>>>> CREATE ROLE role_rap_apply
>>>> GRANT ROLE role_rap_apply TO rap_apply
>>>> CREATE ROLE role_rap_create
>>>> GRANT ROLE role_rap_create TO rap_create
#### create privilege requires CREATE ROW ACCESS POLICY
Error: APIError: QueryFailed: [1063]Permission denied: privilege [CreateRowAccessPolicy] is required on *.* for user 'rap_create'@'%' with roles [public,role_rap_create]. Note: Please ensure that your current role have the appropriate permissions to create a new Object
>>>> GRANT CREATE ROW ACCESS POLICY ON *.* TO USER rap_create
Error: APIError: QueryFailed: [1061]CREATE-like privileges cannot be granted directly to USER; please grant them to a role
<<<<
>>>> GRANT CREATE ROW ACCESS POLICY ON *.* TO ROLE role_rap_create
>>>> CREATE ROW ACCESS POLICY rap_dept AS (dept STRING) RETURNS boolean -> dept = 'security';
#### apply privilege requires APPLY on row access policy
>>>> GRANT ALTER ON default.rap_rbac TO ROLE role_rap_apply
>>>> ALTER TABLE rap_rbac ADD ROW ACCESS POLICY rap_region ON (region)
Error: APIError: QueryFailed: [1063]Permission denied: APPLY ROW ACCESS POLICY or OWNERSHIP is required on ROW ACCESS POLICY rap_region for user 'rap_apply'@'%'
>>>> GRANT APPLY ON ROW ACCESS POLICY rap_region TO ROLE role_rap_apply
1
>>>> GRANT OWNERSHIP ON ROW ACCESS POLICY rap_region TO ROLE role_rap_apply
2
>>>> ALTER TABLE rap_rbac DROP ROW ACCESS POLICY rap_region
Error: APIError: QueryFailed: [1063]Permission denied: APPLY ROW ACCESS POLICY or OWNERSHIP is required on ROW ACCESS POLICY rap_dept for user 'rap_apply'@'%'
>>>> GRANT APPLY ROW ACCESS POLICY ON *.* TO ROLE role_rap_apply
2
1
#### cleanup row access policy rbac environment
>>>> DROP TABLE IF EXISTS rap_rbac
>>>> DROP ROW ACCESS POLICY IF EXISTS rap_region
>>>> DROP ROW ACCESS POLICY IF EXISTS rap_dept
>>>> DROP USER IF EXISTS rap_create
>>>> DROP USER IF EXISTS rap_apply
>>>> DROP ROLE IF EXISTS role_rap_apply
>>>> DROP ROLE IF EXISTS role_rap_create
